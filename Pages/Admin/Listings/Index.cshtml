@page
@model LocalBakery.Pages.Admin.Listings.IndexModel
@{
  ViewData["Title"] = "Listings Admin";
}

<section style="display:grid; gap:20px;">
  <header class="section-header">
    <div>
      <h1 style="margin:0;">Listings Admin</h1>
      <p class="muted" style="margin:4px 0 0;">Manage listings, pricing, and availability.</p>
    </div>
    <div class="inline-actions">
      <a class="button primary" href="/Admin/Listings/Create">Add Listing</a>
      <form method="post" asp-page-handler="RefreshInventory" style="display:inline;">
        <button type="submit">Reset Daily Stock</button>
      </form>
      <a class="button" href="/Admin/Dashboard">View Dashboard</a>
    </div>
  </header>

  <div class="table-wrap">
    <table class="responsive-table">
      <thead>
        <tr>
          <th>Item</th>
          <th>Category</th>
          <th>Price</th>
          <th>Available</th>
          <th>Stock</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        @foreach (var item in Model.Items)
        {
          <tr>
            <td class="table-item" data-label="Item">
              @{
                var imagePath = string.IsNullOrWhiteSpace(item.ImagePath)
                  ? "/images/placeholder.svg"
                  : item.ImagePath;
              }
              <img src="@imagePath" alt="" style="width:42px; height:42px; border-radius:10px; object-fit:cover;" />
              <div>
                <div style="font-weight:600;">@item.Name</div>
                <div class="muted" style="font-size:12px;">@item.TagsCsv</div>
              </div>
            </td>
            <td data-label="Category">@item.Category</td>
            <td data-label="Price">@item.Price.ToString("C")</td>
            <td data-label="Available">@(item.IsAvailable ? "Yes" : "No")</td>
            <td data-label="Stock">
              @(item.DailyStock <= 0
                  ? "Unlimited"
                  : $"{item.DailyStockRemaining}/{item.DailyStock}")
            </td>
            <td class="actions-cell" data-label="Actions" style="text-align:right;">
              <div class="inline-actions" style="justify-content:flex-end;">
                <a class="button" href="/Admin/Listings/Edit?id=@item.Id">Edit</a>
                <a class="button" href="/Admin/Listings/Delete?id=@item.Id">Delete</a>
              </div>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</section>
